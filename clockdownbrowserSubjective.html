<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <link href="homepage.css" rel="stylesheet">
  <link href="lockdownbrowser.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">



</head>

<body style="background-color: lightsteelblue"> 

  <header>
    <nav>
      <input type="checkbox" id="check">
      <label for="check" class="checkbtn">
        <i class="fas fa-bars"></i>
      </label>
      <!-- <label><img src="logo.png"></label> -->
      <label class="logoh"><img src="assets\img\logo ecs.png">ECS</label>
      <ul>


        <li><a style="color:black;text-decoration: none;" href="homeEmployer.html" id="userlink">Home</a></li>
       
        
        <li><a style="text-decoration: none;" href="chomepage.html">Exit</a></li>
      </ul>
    </nav>
  </header>





  <div class="row">
    <div class="col">
      <video class="img-fluid">  </video>
    </div>
    <div class="col">
      <img class="img-fluid" src="http://10.213.68.227:8080/video" alt="phone camera">
    </div>
  </div>


<section id="about" class="about">
  <div class="col">
  
    

    

  
    <div class="container" data-aos="fade-up">

      <div class="row">
        <div class="col-lg-6 order-1 order-lg-2" data-aos="fade-left" data-aos-delay="100">
        </div>
        <h2 id="qn">Question Number:</h2>
        
        <form class="question ml-sm-5 pl-sm-5 pt-2" name="jawapan">
            <div class="py-2 h5" >
              <h4 id="eq">1. /* Increment y if x is equals to 5 */ </h4>
              </div>
            <div class="ml-md-3 ml-sm-3 pl-md-5 pt-sm-0 pt-3" id="options"> 
              <div class="form-check">
                  <textarea placeholder="Write answer here..." class="anspaper" aria-label="With textarea" id="jawpanExam"></textarea>
                
              </div>
      
             
            
            </div>
        <div class="d-flex align-items-center pt-3">
        </div>
    </form>


      

      <div class="row g-3">
        <div class="col">

          <button class="btn btn-primary" id="minexam">Back</button> 
          <button class="btn btn-primary" id="addexam">Next</button> 
                      
          </div>
    <div class="col-md-2">
       
        <button class="btn btn-primary" id="submitbtn">Submit</button> 
        
    </div>
  </div>
    


    

    

 
 




    
  </section>
  
  <!-- End About Section -->


  <button id="masa" class="open-button1" ></button>
  <button id="lecturer" class="open-button2" onclick="openFormlec()">Lecturer</button>
  
  
  


  <!-- <div class="container">
    <div class="row">
      <div class="col-8">col-8</div>
      <div class="col-4">col-4</div>
    </div>
  </div> -->

  <div id="chatlec">
    <!-- messages will display here -->
    <ul id="messageslec"></ul>

    <!-- form to send message -->
    <form id="message-formlec">

    </form>


   <div class="chat-popup" id="myFormlec">
     <form class="form-container">


       <h5>Chat with lecturer</h5>



      <ul id="dispmessagelec"></ul>




      



      



      <input id="message-inputlec" type="text" />
      <button type="button" onclick="sendMessagelec()">Send</button>
       <button type="button" class="btn cancel" onclick="closeFormlec()">Close</button>
     </form>
   </div>
  </div>







  <div id="chat">
    <!-- messages will display here -->
    <ul id="messages"></ul>

    <!-- form to send message -->
    <form id="message-form">

    </form>

    <button class="open-button" onclick="openForm()">Exam Invigilator</button>

   <div class="chat-popup" id="myForm">
     <form class="form-container">


       <h5>Chat with Exam Invigilator</h5>



      <ul id="dispmessage"></ul>




      



      



      <input id="message-input1" type="text" />
      <button type="button" onclick="sendMessage()">Send</button>
       <button type="button" class="btn cancel" onclick="closeForm()">Close</button>
     </form>
   </div>
  </div>

  

   

  


   

  


  
  
   



  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  

  <script>

const submit = document.getElementById('nextp');

function nextpage(){
    window.location = "lockdownBrowser.html";
}

submit.addEventListener('click', nextpage);


  </script>

  


<script>






//setInterval(myTimer, 1000);

// function myTimer() {
//   const d = new Date();
//   document.getElementById("masa").innerHTML = d.toLocaleTimeString();
// }



    var i =10000;
    
    document.addEventListener('visibilitychange', function(){
        if (document.visibilityState === "hidden"){
          i--;
           window.alert("your exam will be terminate if you leave this browser " + i + "  more time");
          updatestatusdb(i);
                 
        }

        if(i<1){

        alert('sorry');
        location.href = 'homepage.html';
                    
        }
        
    })

function updatestatusdb(att){

var statusc = att;
getUsername();
userlink.innerText = currentUser.MatricNumber;
console.log("moeh" + userlink.innerText)

firebase.database().ref('CandidateStatus').child(userlink.innerText).update({       
    status: "Total of attempt left :"+ statusc,
    
})

}

    function submite(){
      alert("Exam being submitted")
      location.href = 'homepage.html';
    }

    submitbtn.addEventListener('click', submite);


    
    
    
    </script>



<script type="module">

  // Import the functions you need from the SDKs you need
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyB9tp7nBfMxsqBqgyQsCXE8gDhx7BSAaIk",
  authDomain: "e-cs-8e95e.firebaseapp.com",
  databaseURL: "https://e-cs-8e95e-default-rtdb.firebaseio.com",
  projectId: "e-cs-8e95e",
  storageBucket: "e-cs-8e95e.appspot.com",
  messagingSenderId: "648134779146",
  appId: "1:648134779146:web:c48d9e26dfeaa1d04d9af3"
};


  // Initialize Firebase

  const app = initializeApp(firebaseConfig);

  import { getDatabase, ref, set, child, get }
    from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

  const db = getDatabase();

  const dbRef = ref(db);

  let questnum = 1;
  let numq = 1;






          let userlink = document.getElementById('userlink');
          let userlink1 = document.getElementById('userlink1');
          let signoutlink = document.getElementById('signoutlink');
          var currentUser = null;
          var updBtn = document.getElementById("upd");

          let exa = document.getElementById("jawpanExam")


          let coursecode = localStorage.getItem('course');

console.log(coursecode + "banana" );

get(child(dbRef, "ExamCourse/" + coursecode)).then((snapshot) => {
            
            if (snapshot.exists()) {
              questnum = snapshot.val().examQuestionNumber;
              const examduration = parseInt(snapshot.val().examDuration);
              masaexam(examduration);


                 console.log(questnum + " hello " + examduration);
                }
                
              
            });



//soalan exam dekat sini
get(child(dbRef, "ExamCoursePaper/" + coursecode + "/" + numq)).then((snapshot) => {

  
            
            if (snapshot.exists()) {
              console.log("apaaa")
            let  examQuestionNumber = snapshot.val().examQuestionNumber;

            let examQuestion = snapshot.val().examQuestion;


                 console.log(questnum + " hello ");
                 document.getElementById("qn").innerHTML = "Question Number :"+ examQuestionNumber;
                 document.getElementById("eq").innerHTML = "Exam Question : <br><br>"+ examQuestion;

           

                 
                 

    
                }

                
                
              
            });




function masaexam(m){
  // Set the date we're counting down to
  console.log("sdabyhsabd" + m)
var countDownDate1 = new Date().toLocaleTimeString() ;
var countDownDate = new Date().getTime() + m;
console.log(m + "apa ini");

// Update the count down every 1 second
var x = setInterval(function() {

  // Get today's date and time
  var now = new Date().getTime();
//  console.log("here is "+ now)

  // Find the distance between now and the count down date
  var distance = countDownDate - now;

  // Time calculations for days, hours, minutes and seconds
  var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
  var seconds = Math.floor((distance % (1000 * 60)) / 1000);

  // Display the result in the element with id="demo"
  document.getElementById("masa").innerHTML = hours + "h "
  + minutes + "m " + seconds + "s ";

  // If the count down is finished, write some text
  if (distance < 0) {
    clearInterval(x);
    document.getElementById("masa").innerHTML = "EXPIRED";
  }
}, 1000);
}









function getUsername() {
  let keepLoggedIn = localStorage.getItem("keepLoggedIn");

  if (keepLoggedIn == "yes") {
      currentUser = JSON.parse(localStorage.getItem('user'));
  }

  else {
      currentUser = JSON.parse(sessionStorage.getItem('user'));
  }
}

          getUsername();
          userlink.innerText = currentUser.MatricNumber;
      
         

      
          function Signout() {
              sessionStorage.removeItem('user');
              localStorage.removeItem('user');
              localStorage.removeItem('keepLoggedIn');
              window.location = "register.html";
          }
      
         


          const vid = document.querySelector('video');

// navigator.mediaDevices.getUserMedia({video: true}) // request cam
// .then(stream => {
//   vid.srcObject = stream; // don't use createObjectURL(MediaStream)
//   return vid.play(); // returns a Promise
// })
// .then(()=>{ // enable the button
//   const btn = document.getElementById('apo');
//   btn.disabled = false;
//   btn.onclick = e => {
//     takeASnap();
    
//   };


// });
function backq(){

    if(exa.value!=""){
   tambahjawapan(numq); 
}

  
  if(numq>1){
 
  numq--;






const dbRef = ref(db);

let coursecode = localStorage.getItem('course');

console.log(coursecode +"sini" );




get(child(dbRef, "ExamCoursePaper/" + coursecode + "/" + numq)).then((snapshot) => {
            
            if (snapshot.exists()) {
              let  examQuestionNumber = snapshot.val().examQuestionNumber;

let examQuestion = snapshot.val().examQuestion;

 

     console.log(questnum + " hello ");
     document.getElementById("qn").innerHTML = "Question Number :"+ examQuestionNumber;
     document.getElementById("eq").innerHTML = "Exam Question : <br><br> "+ examQuestion;

                 
;
    
                }
                
              
            });



}


}





function nextq() {
    
if(exa.value!=""){
   tambahjawapan(numq); 
}

  if(numq<questnum){
  numq++;






const dbRef = ref(db);

let coursecode = localStorage.getItem('course');

console.log(coursecode +"sini" );




get(child(dbRef, "ExamCoursePaper/" + coursecode + "/" + numq)).then((snapshot) => {
            
            if (snapshot.exists()) {
            let  examQuestionNumber = snapshot.val().examQuestionNumber;

            let examQuestion = snapshot.val().examQuestion;

          

                 console.log(questnum + " hello ");
                 document.getElementById("qn").innerHTML = "Question Number :"+ examQuestionNumber;
                 document.getElementById("eq").innerHTML = "Exam Question : <br> <br> "+ examQuestion;

              
                 
;
    
                }
                
              
            });



// show selected on page load

  

//tambah jawapan dalam database



  
  


  



// if(numq<questnum){
//   numq++;
//   document.getElementById("qn").innerHTML = "Question Number :"+ numq;
// }else{
  
// alert("complete added questions")
// window.location = "homepagep.html";

// }
      
        
      
   
  

  



}



function tambahjawapan(y){

 
  

  set(ref(db, "ExamCoursePaperAnswer/" + coursecode + "/" + userlink.innerText + "/" + y),
                {
                  
                  examQuestionNumber: y,
                  examAnswer: exa.value
                })
                .then(() => {
                  alert("successfully added exam answer for " )
                  exa.value = ""
                  

                  

                  


                })
                .catch((error) => {
                  alert("error" + error);
                })




}
}






  
  
addexam.addEventListener('click', nextq);
minexam.addEventListener('click', backq);


</script>
<script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-database.js"></script>
<script defer src="ch.js"></script>


</body>
</html>
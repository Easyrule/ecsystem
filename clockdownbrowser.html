<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">

  <link href="homepage.css" rel="stylesheet">
  <link href="clockdownbrowser.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

  <script src=
  "https://cdn.jsdelivr.net/npm/html2canvas@1.0.0-rc.5/dist/html2canvas.min.js">
      </script>

</head>

<body style="background-color: lightsteelblue" class="node88" oncontextmenu="return noMenu();" onkeydown="return disableCopyPaste();"> 

  <header>
    <nav>
      <input type="checkbox" id="check">
      <label for="check" class="checkbtn">
        <i class="fas fa-bars"></i>
      </label>
      <!-- <label><img src="logo.png"></label> -->
      <label class="logoh"><img src="assets\img\logo ecs.png">ECS</label>
      <ul>


        <li><a style="color:black;text-decoration: none;" href="homeEmployer.html" id="userlink">Home</a></li>
       
        
        <li><a style="text-decoration: none;" href="chomepage.html">Exit</a></li>
      </ul>
    </nav>
  </header>




  

  <br><br>

  <div class="container" >
    <div class="row">
      <div class="col"  >
        <h3 style="color:white"> Front View </h3>
      <img crossorigin="anonymous" style="object-fit: cover ; width : 100% ; height: 92%"  class="rounded-0" id="frontcamera" alt="front camera">  
      
      
    </div>
      <div class="col">
        
        <h3 style="color:white"> Back View </h3>
      <img style="object-fit: cover ; width : 100% ; height: 92%"  class="rounded-0" id="phonecamera" alt="back camera">

      </div>
    </div>
    </div>

    
  
<section id="about" class="about">
  <div class="col">
  
    

    

  
    <div class="container" style="background-color:rgb(215, 236, 243); color:black" data-aos="fade-up">

      <div class="row">
        <div class="col-lg-6 order-1 order-lg-2" data-aos="fade-left" data-aos-delay="100">
        </div>
        <h2 id="qn">Question Number:</h2>
        
          <form class="question ml-sm-5 pl-sm-5 pt-2" name="jawapan">
              <div class="py-2 h5" >
                <h3 id="eq">1. /* Increment y if x is equals to 5 */ </h3>
                </div>
              <div class="ml-md-3 ml-sm-3 pl-md-5 pt-sm-0 pt-3" id="options"> 
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="flexRadioDefault" id="answA">
                  <label class="form-check-label" for="flexRadioDefault1" id="ansA" >
                    Default radio
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="flexRadioDefault" id="answB" checked>
                  <label class="form-check-label" for="flexRadioDefault2" id="ansB">
                    Default checked radio
                  </label>
                </div>

                <div class="form-check">
                  <input class="form-check-input" type="radio" name="flexRadioDefault" id="answC">
                  <label class="form-check-label" for="flexRadioDefault3" id="ansC">
                    Default radio
                  </label>
                </div>
                <div class="form-check">
                  <input value="hawauuu" class="form-check-input" type="radio" name="flexRadioDefault" id="answD" checked>
                  <label class="form-check-label" for="flexRadioDefault4" id="ansD">
                    Default checked radio
                  </label>
                </div>
               
              
              </div>
          <div class="d-flex align-items-center pt-3">
          </div>
      </form>


      

      <div class="row g-3">
        <div class="col">

          <button class="btn btn-primary" id="minexam">Back</button> 
          <button class="btn btn-primary" id="addexam">Next</button> 
                      
          </div>
    <div class="col-md-2">
       
        <button class="btn btn-primary" id="submitbtn">Submit</button> 
        
    </div>
  </div>
    


    

    

 
 




    
  </section>
  
  <!-- End About Section -->


  <button id="masa" class="open-button1" ></button>
  <button id="lecturer" class="open-button2" onclick="openFormlec()">Lecturer</button>
  
  
  


  <!-- <div class="container">
    <div class="row">
      <div class="col-8">col-8</div>
      <div class="col-4">col-4</div>
    </div>
  </div> -->

  <div id="chatlec">
    <!-- messages will display here -->
    <ul id="messageslec"></ul>

    <!-- form to send message -->
    <form id="message-formlec">

    </form>


   <div class="chat-popup" id="myFormlec">
    <form class="form-container" style="background-color:cadetblue; color: white;">


      <h5 style="font-family:'Courier New'">Chat with lecturer: <br><br></h5>



      <ul style=" background-color:white ; color:black ;padding-bottom: 10%; overflow: auto; margin: auto; height: 200px;" id="dispmessagelec"></ul>




      


<br>
      



      <input id="message-inputlec" type="text" />
      <button type="button" style="background-color: lightgrey;" onclick="sendMessagelec()">Send</button>
      <br><br>
      <button type="button" class="btn cancel" onclick="closeFormlec()">Close</button>
     </form>
   </div>
  </div>







  <div id="chat">
    <!-- messages will display here -->
    <ul id="messages"></ul>

    <!-- form to send message -->
    <form id="message-form">

    </form>

    <button class="open-button" onclick="openForm()">Exam Invigilator</button>

   <div class="chat-popup" id="myForm">
    <form class="form-container" style="background-color:cadetblue; color: white;">


      <h5 style="font-family:'Courier New'">Chat with Exam Invigilator: <br><br></h5>



      <ul style=" background-color:white ; color:black ;padding-bottom: 10%; overflow: auto; margin: auto; height: 200px;" id="dispmessage"></ul>

<br>


      



      



      <input id="message-input1" type="text" />
      <button type="button" style="background-color: lightgrey;"  onclick="sendMessage()">Send</button>
      <br><br>
  <button type="button" class="btn cancel" onclick="closeForm()">Close</button>
     </form>
   </div>
  </div>


  <div hidden class="container">
    <div hidden class="row">
      <div class="col">
        1 of 2
        <div id="photo" >
        
  
          <p>Canvas:</p>
  <canvas id="myCanvas" style=" width : 100% ; height: 100%">
  Your browser does not support the HTML5 canvas tag.
  </canvas>
      
        
      
          <!-- Define the button 
          that will be used to 
          take the screenshot -->
          <button  hidden onclick="takeshot()">
      
          </button>
      </div>
      </div>
      <div hidden class="col">
  

        <h1 hidden >Screenshot:</h1>
  <div hidden id="output1">hhhhh</div>
      </div>
    </div>
    </div>
  

   

  


   

  


  
  
   



  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  
 
 

  


  <script>
    
    window.onbeforeunload = function() {
        return "You may be disqualified";
    }
    
function noMenu() {
  return false;
}
function disableCopyPaste(elm) {
  // Disable cut/copy/paste key events
  elm.onkeydown = interceptKeys
  // Disable right click events
  elm.oncontextmenu = function() {
    return false
  }
}
function interceptKeys(evt) {
  evt = evt||window.event // IE support
  var c = evt.keyCode
  var ctrlDown = evt.ctrlKey||evt.metaKey // Mac support
  // Check for Alt+Gr (http://en.wikipedia.org/wiki/AltGr_key)
  if (ctrlDown && evt.altKey) return true
  // Check for ctrl+c, v and x
  else if (ctrlDown && c==67) return false // c
  else if (ctrlDown && c==86) return false // v
  else if (ctrlDown && c==88) return false // x
  // Otherwise allow
  return true
}

//disable copy paste 

    function takeshot() {
   
     var c = document.getElementById("myCanvas");
     var ctx = c.getContext("2d");
     var imageObj = document.getElementById("frontcamera");
     ctx.canvas.width = imageObj.width;
     ctx.canvas.height = imageObj.height;
     ctx.drawImage(imageObj, 0, 0,imageObj.width,imageObj.height);
   
   
   
   
               let div =
                   document.getElementById('myCanvas');
     
               // Use the html2canvas
               // function to take a screenshot
               // and append it
               // to the output div
               html2canvas(div).then(
                   function (canvas) {
                       document
                       .getElementById('output1')
                       .appendChild(canvas);
                       var dataURL = div.toDataURL();
     console.log(dataURL);
   
     imgdata1 = getBase64Image(div);
     localStorage.setItem("imgData1", imgdata1);
   console.log("hollllaaaa" +  imgdata1)
                      
                       
                   })
           }
   
   
   
   //cuba tambah image ke local storage
   function getBase64Image(img) {
   
   
     var dataURL = img.toDataURL("image/png");
   
     return dataURL.replace(/^data:image\/(png|jpg);base64,/, "");
   }
   
   
   
   
     </script>



<script type="module">

  

var i =3;
    
    document.addEventListener('visibilitychange', function(){
        if (document.visibilityState === "hidden"){
          i--;
           window.alert("your exam will be terminate if you leave this browser " + i + "  more time");
          updatestatusdb(i);
                 
        }

        if(i<1){

        alert('sorry');
        location.href = 'chomepage.html';
                    
        }
        
    })

function updatestatusdb(att){

var statusc = att;
getUsername();
userlink.innerText = currentUser.MatricNumber;
console.log("moeh" + userlink.innerText)

firebase.database().ref('CandidateStatus').child(userlink.innerText).update({       
    status: statusc,
    
})

}

   

    

  // Import the functions you need from the SDKs you need
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyB9tp7nBfMxsqBqgyQsCXE8gDhx7BSAaIk",
  authDomain: "e-cs-8e95e.firebaseapp.com",
  databaseURL: "https://e-cs-8e95e-default-rtdb.firebaseio.com",
  projectId: "e-cs-8e95e",
  storageBucket: "e-cs-8e95e.appspot.com",
  messagingSenderId: "648134779146",
  appId: "1:648134779146:web:c48d9e26dfeaa1d04d9af3"
};


  // Initialize Firebase

  const app = initializeApp(firebaseConfig);

  import { getDatabase, ref, set, child, get }
    from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

  const db = getDatabase();

  const dbRef = ref(db);

  let questnum = 1;
  let numq = 1;






          let userlink = document.getElementById('userlink');
          let userlink1 = document.getElementById('userlink1');
          let signoutlink = document.getElementById('signoutlink');
          var currentUser = null;
          var updBtn = document.getElementById("upd");


          let coursecode = localStorage.getItem('course');
          

          let fview = document.getElementById('frontcamera');
          let bview = document.getElementById('phonecamera');

          getUsername();

//sini nak buat double verification




console.log(coursecode + "banana" );

get(child(dbRef, "ExamCourse/" + coursecode)).then((snapshot) => {
            
            if (snapshot.exists()) {
              questnum = snapshot.val().examQuestionNumber;
              const examduration = parseInt(snapshot.val().examDuration);
              masaexam(examduration);


                 console.log(questnum + " hello " + examduration);
                }
                
              
            });
 
get(child(dbRef, "CandidateMonitor/" + currentUser.MatricNumber + "/frontview" )).then((snapshot) => {
            
            if (snapshot.exists()) {
              let flink = snapshot.val().linkfrontcamera;
              fview.src = flink;


                 console.log(questnum + " hello " + examduration);
                }
                
              
});

get(child(dbRef, "CandidateMonitor/" + currentUser.MatricNumber + "/backview" )).then((snapshot) => {
            
            if (snapshot.exists()) {
              let blink = snapshot.val().linkbackcamera;
              bview.src = blink;


                 console.log(questnum + " hello " + examduration);
                }
                
              
});



//soalan exam dekat sini
get(child(dbRef, "ExamCoursePaper/" + coursecode + "/" + numq)).then((snapshot) => {

  
            
            if (snapshot.exists()) {
              console.log("apaaa")
            let  examQuestionNumber = snapshot.val().examQuestionNumber;

            let examQuestion = snapshot.val().examQuestion;

             let AnswerA = snapshot.val().examAnswerA;
             let AnswerB = snapshot.val().examAnswerB;
             let AnswerC = snapshot.val().examAnswerC;
             let AnswerD = snapshot.val().examAnswerD;

                 console.log(questnum + " hello ");
                 document.getElementById("qn").innerHTML = "Question Number :"+ examQuestionNumber;
                 document.getElementById("eq").innerHTML = "Exam Question :"+ examQuestion;

                 document.getElementById("ansA").innerHTML = "A :"+ AnswerA;
                 document.getElementById("ansB").innerHTML = "B :"+ AnswerB;
                 document.getElementById("ansC").innerHTML = "C :"+ AnswerC;
                 document.getElementById("ansD").innerHTML = "D :"+ AnswerD;


                 document.getElementById("answA").value = "A";
                 document.getElementById("answB").value = "B";
                 document.getElementById("answC").value = "C";
                 document.getElementById("answD").value = "D";

                 
                 

    
                }

                
                
              
            });




function masaexam(m){
  // Set the date we're counting down to
  console.log("sdabyhsabd" + m)
var countDownDate1 = new Date().toLocaleTimeString() ;
var countDownDate = new Date().getTime() + m;
console.log(m + "apa ini");

// Update the count down every 1 second
var x = setInterval(function() {

  // Get today's date and time
  var now = new Date().getTime();
//  console.log("here is "+ now)

  // Find the distance between now and the count down date
  var distance = countDownDate - now;

  // Time calculations for days, hours, minutes and seconds
  var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
  var seconds = Math.floor((distance % (1000 * 60)) / 1000);

  // Display the result in the element with id="demo"
  document.getElementById("masa").innerHTML = hours + "h "
  + minutes + "m " + seconds + "s ";

  // If the count down is finished, write some text
  if (distance < 0) {
    clearInterval(x);
    document.getElementById("masa").innerHTML = "EXPIRED";
  }
}, 1000);
}









function getUsername() {
  let keepLoggedIn = localStorage.getItem("keepLoggedIn");

  if (keepLoggedIn == "yes") {
      currentUser = JSON.parse(localStorage.getItem('user'));
  }

  else {
      currentUser = JSON.parse(sessionStorage.getItem('user'));
  }
}

          getUsername();
          userlink.innerText = currentUser.MatricNumber;
      
         

      
          function Signout() {
              sessionStorage.removeItem('user');
              localStorage.removeItem('user');
              localStorage.removeItem('keepLoggedIn');
              window.location = "register.html";
          }
      
         


          const vid = document.querySelector('video');

// navigator.mediaDevices.getUserMedia({video: true}) // request cam
// .then(stream => {
//   vid.srcObject = stream; // don't use createObjectURL(MediaStream)
//   return vid.play(); // returns a Promise
// })
// .then(()=>{ // enable the button
//   const btn = document.getElementById('apo');
//   btn.disabled = false;
//   btn.onclick = e => {
//     takeASnap();
    
//   };


// });






function nextq() {
  console.log("numq " + numq + "questnum " + questnum);
  tambahjawapan(numq);

  if(numq<questnum){
  numq++;






const dbRef = ref(db);

let coursecode = localStorage.getItem('course');

console.log(coursecode +"sini" );




get(child(dbRef, "ExamCoursePaper/" + coursecode + "/" + numq)).then((snapshot) => {
            
            if (snapshot.exists()) {
            let  examQuestionNumber = snapshot.val().examQuestionNumber;

            let examQuestion = snapshot.val().examQuestion;

             let AnswerA = snapshot.val().examAnswerA;
             let AnswerB = snapshot.val().examAnswerB;
             let AnswerC = snapshot.val().examAnswerC;
             let AnswerD = snapshot.val().examAnswerD;

                 console.log(questnum + " hello ");
                 document.getElementById("qn").innerHTML = "Question Number :"+ examQuestionNumber;
                 document.getElementById("eq").innerHTML = "Exam Question :"+ examQuestion;

                 document.getElementById("ansA").innerHTML = "A :"+ AnswerA;
                 document.getElementById("ansB").innerHTML = "B :"+ AnswerB;
                 document.getElementById("ansC").innerHTML = "C :"+ AnswerC;
                 document.getElementById("ansD").innerHTML = "D :"+ AnswerD;


                 document.getElementById("answA").value = "A";
                 document.getElementById("answB").value = "B";
                 document.getElementById("answC").value = "C";
                 document.getElementById("answD").value = "D";
                 
;
    
                }
                
              
            });



// show selected on page load

  

//tambah jawapan dalam database



  
  


  



// if(numq<questnum){
//   numq++;
//   document.getElementById("qn").innerHTML = "Question Number :"+ numq;
// }else{
  
// alert("complete added questions")
// window.location = "homepagep.html";

// }
      
        
      
   
  

  



}

function tambahjawapan(y){

 
 const form = document.forms.jawapan;
const radios = Array.from(form.elements.flexRadioDefault);
// show latest value when radio checked changes
radios.forEach(radio => {
  radio.addEventListener('change', () => {
    

    console.log(x + "pekak waknat" + userlink.innerText)
    
  });
});

  set(ref(db, "ExamCoursePaperAnswer/" + coursecode + "/" + userlink.innerText + "/" + y),
                {
                  
                  examQuestionNumber: y,
                  examAnswer: form.querySelector('input[name=flexRadioDefault]:checked').value
                })
                .then(() => {
                  alert("successfully added exam answer for " )

                  

                  


                })
                .catch((error) => {
                  alert("error" + error);
                })




}
}

function submite(){
      takeshot();
      alert("Exam being submitted")
      location.href = 'cexamscript.html';
    }



function backq(){
  if(numq>1){
  numq--;






const dbRef = ref(db);

let coursecode = localStorage.getItem('course');

console.log(coursecode +"sini" );




get(child(dbRef, "ExamCoursePaper/" + coursecode + "/" + numq)).then((snapshot) => {
            
            if (snapshot.exists()) {
              let  examQuestionNumber = snapshot.val().examQuestionNumber;

let examQuestion = snapshot.val().examQuestion;

 let AnswerA = snapshot.val().examAnswerA;
 let AnswerB = snapshot.val().examAnswerB;
 let AnswerC = snapshot.val().examAnswerC;
 let AnswerD = snapshot.val().examAnswerD;

     console.log(questnum + " hello ");
     document.getElementById("qn").innerHTML = "Question Number :"+ examQuestionNumber;
     document.getElementById("eq").innerHTML = "Exam Question :"+ examQuestion;

     document.getElementById("ansA").innerHTML = "A :"+ AnswerA;
     document.getElementById("ansB").innerHTML = "B :"+ AnswerB;
     document.getElementById("ansC").innerHTML = "C :"+ AnswerC;
     document.getElementById("ansD").innerHTML = "D :"+ AnswerD;


     document.getElementById("ansA").value = "A";
     document.getElementById("ansB").value = "B";
     document.getElementById("ansC").value = "D";
     document.getElementById("ansD").value = "C";
                 
;
    
                }
                
              
            });



}


}
  
  
addexam.addEventListener('click', nextq);
minexam.addEventListener('click', backq);
submitbtn.addEventListener('click', submite);


</script>
<script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-database.js"></script>
<script defer src="ch.js"></script>


</body>
</html>
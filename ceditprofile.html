<!DOCTYPE html>
<html>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
        <link rel = "stylesheet" href="profile.css">
        <link rel = "stylesheet" href="homepage.css">
        

        

        <link
    href="https://fonts.googleapis.com/css2?family=Poppins&display=swap"
    rel="stylesheet">

    







    </header>

    <body style="background-color: lightsteelblue">

        <header>
            <nav>
              <input type="checkbox" id="check">
              <label for="check" class="checkbtn">
                <i class="fas fa-bars"></i>
              </label>
              <!-- <label><img src="logo.png"></label> -->
              <label class="logoh"><img src="assets\img\logo ecs.png">ECS</label>
              <ul>
        
        
                <li><a style="color:black;text-decoration: none;" href="homepage.html" id="userlink">Home</a></li>
                <div class="dropdown">
                  <button href="homepage.html" class="dropbtn">Home</button>
                  <div class="dropdown-content">
                    <a href="cdashboard.html">Dashboard</a>
                    <a href="cprofile.html">Profile</a>
                    <a href="centerexam.html">Exam</a>
                  </div>
                </div>
                
                <li><a style="text-decoration: none;" href="login.html" id="signoutlink">Sign Out</a></li>
              </ul>
            </nav>
          </header>


          <section id="about" class="about">
            <div class="container" data-aos="fade-up">
        
              <div class="row">
                
                <div class="profile-form container-fluid allign-items-center">
                    <div class="container">
                        <div class="row">
                            <div class="col-12 p-0">
                                
                            </div>
                            <div class="col-md-5">
                                <div class="row">
                                    <div class="col-12 bg-white p-0 px-3 py-3 mb-3">
                                        <div class="d-flex flex-column align-items-center"> <img class="photo" id="output" src="https://www.kindpng.com/picc/m/22-223941_transparent-avatar-png-male-avatar-icon-transparent-png.png" alt="">
                                            <input type="file" accept="image/*" id="imgu" onchange="loadFile(event)">
                                            <p class="fw-bold h4 mt-3" id="userlink1"></p>
                                            <div class="d-flex ">
                                                <div class="btn btn-primary" id="save" onclick="uploadImage()">Save</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            <div class="col-md-7 ps-md-4">
                                <div class="row">
                                    <div class="col-12 bg-white px-3 mb-3 pb-3">
                                        <div class="d-flex align-items-center justify-content-between border-bottom">
                                            <p class="py-2">Full Name</p>
                                            <p class="py-2 text-muted" id="nama"></p>
                                        </div>
                                        <div class="d-flex align-items-center justify-content-between border-bottom">
                                            <p class="py-2">Email</p>
                                            <p class="py-2 text-muted" id="aemail">fip@jukmuh.al</p>
                                        </div>
                                        <div class="d-flex align-items-center justify-content-between border-bottom">
                                            <p class="py-2">Matric No.</p>
                                            <p class="py-2 text-muted" id="matric">(239) 816-9029</p>
                                        </div>
                                        <div class="d-flex align-items-center justify-content-between border-bottom">
                                            <p class="py-2">Mobile</p>
                                            <input type="username" class="form-control" id="mobile" placeholder="012-3456789">
                                        </div>
                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <p class="py-2">Index Number</p>
                                            <input type="username" class="form-control" id="indexno" placeholder="77777"> <br>
                                            <div class="btn btn-primary follow me-2" id="update" onclick="updatedb()">Update</div>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
        
                </div>
        
                </div>
              </div>
        
            </div>
          </section>

          





        
           
        
        

        <!-- <script type="module">

            
    // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig1 = {
    apiKey: "AIzaSyB9tp7nBfMxsqBqgyQsCXE8gDhx7BSAaIk",
    authDomain: "e-cs-8e95e.firebaseapp.com",
    databaseURL: "https://e-cs-8e95e-default-rtdb.firebaseio.com",
    projectId: "e-cs-8e95e",
    storageBucket: "e-cs-8e95e.appspot.com",
    messagingSenderId: "648134779146",
    appId: "1:648134779146:web:c48d9e26dfeaa1d04d9af3"
  };


    // Initialize Firebase

    const app1 = initializeApp(firebaseConfig1);

    import { getDatabase, ref, set, child, get }
      from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

    const db1 = getDatabase();

    const matric = document.getElementById('userlink');
    console.log(userlink)
    const save = document.getElementById('save');

    


    function RegisterUser() {
      if (!Validation()) {
        return;
      }
      const dbRef = ref(db1);


        
        

          get(child(dbRef, "Candidate/" + matric.value)).then((snapshot) => {

              set(ref(db, "Candidate/" + matric.value),
                {
                  
                  email: email.value,
                  MatricNumber: matric.value,
                  fullname: name.value,
                  password: encPass(),
                  mobile:'012456789',
                  emergencycontactnumber:'012456789',
                  indexnumber:'77777'
                })
                .then(() => {
                  alert("user added successfully");
                })
                .catch((error) => {
                  alert("error" + error);
                })
            
          });
        

        

      

    }




    save.addEventListener('click', RegisterUser);






        </script> -->

        <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-database.js"></script> 
<script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-storage.js"></script> 
        <script>



    let nama = document.getElementById('nama');
    let matric = document.getElementById('matric');
    let emailc = document.getElementById('aemail');

    let contactno = document.getElementById('mobile');
    let indexno = document.getElementById('indexno');

    let imgtag = document.getElementById('output');


    let dp = document.getElementById('dp')

            let userlink = document.getElementById('userlink');
            let userlink1 = document.getElementById('userlink1');
            let signoutlink = document.getElementById('signoutlink');
            var currentUser = null;
            var updBtn = document.getElementById("upd");
        
           
        
            function getUsername() {
                let keepLoggedIn = localStorage.getItem("keepLoggedIn");
        
                if (keepLoggedIn == "yes") {
                    currentUser = JSON.parse(localStorage.getItem('user'));
                }
        
                else {
                    currentUser = JSON.parse(sessionStorage.getItem('user'));
                }
            }
        
            function Signout() {
                sessionStorage.removeItem('user');
                localStorage.removeItem('user');
                localStorage.removeItem('keepLoggedIn');
                window.location = "register.html";
            }
        
            window.onload = function () {
                getUsername();
                if (currentUser == null) {
                    userlink.innerText = "";
                    userlink1.innerText = "";
                    userlink.href = "register.html";
                    signoutlink.innerText = "Login";
                    signoutlink.href = "login.html";
                }
        
                else {
                    userlink.innerText = "Student ID: " + currentUser.MatricNumber;
                    userlink1.innerText = currentUser.MatricNumber;
                    userlink.href = "#";
        
                    signoutlink.innerText = "Sign Out";
                    signoutlink.addEventListener('click', Signout);
                }
            }



            const firebaseConfig = {
    apiKey: "AIzaSyB9tp7nBfMxsqBqgyQsCXE8gDhx7BSAaIk",
    authDomain: "e-cs-8e95e.firebaseapp.com",
    databaseURL: "https://e-cs-8e95e-default-rtdb.firebaseio.com",
    projectId: "e-cs-8e95e",
    storageBucket: "e-cs-8e95e.appspot.com",
    messagingSenderId: "648134779146",
    appId: "1:648134779146:web:c48d9e26dfeaa1d04d9af3"
  };
            // Initialize Firebase
            const app = firebase.initializeApp(firebaseConfig);
            console.log(firebase);
        
            function uploadImage() {
                
              const usern = userlink1.innerText;
              const ref = firebase.storage().ref('GambarDP').child(usern);
              console.log("this is spartaaa "+ ref)
              const file = document.getElementById('imgu').files[0];
              const name = +new Date() + "-" + file.name;
              const metadata = {
                contentType: file.type
              };
              const task = ref.child(name).put(file, metadata);
              task
                .then(snapshot => snapshot.ref.getDownloadURL())
                .then(url => {
                  console.log(url);
                  document.getElementById("output").src = url;
                  uploadrealtime();
                  

                })
                .catch(console.error);
            }


            function uploadrealtime(){
                const file1 = document.getElementById('imgu').files[0];
                const filen = file1.name;
                const usern = userlink1.innerText;

                const urlimg = document.getElementById("output").src;
                console.log("here name "+ file1 + "here url "+ urlimg)
                firebase.database().ref('Candidate').child('Gambar').child(usern).set({       
                    Name: filen,
                    Link: urlimg
                })

                alert("image being updated")

            }

            function updatedb(){

                const mobile = contactno.value;
                const indexn = indexno.value;
                const usern = userlink1.innerText;
                console.log("mo" + mobile + "eh" + indexn)

                firebase.database().ref('Candidate').child(usern).update({       
                    mobile: mobile,
                    indexnumber: indexn
                    
                })

              alert("succefully updated");






            }


            getUsername();

            const nameu= currentUser.MatricNumber;
            var firebaseRef = firebase.database().ref('Candidate').child(nameu);
            var firebaseRef1 = firebase.database().ref('Candidate').child('Gambar').child(nameu);


            firebaseRef.on('value', (snapshot) => {

let nama1 = snapshot.val().fullname;
let matricnumber = snapshot.val().MatricNumber;
let email = snapshot.val().email;
let phone = snapshot.val().mobile;
let indexnumber = snapshot.val().indexnumber;

console.log(nama1)

nama.innerHTML = nama1;
emailc.innerHTML= email;
matric.innerHTML = matricnumber;






console.log(snapshot.val());
}, (errorObject) => {
console.log('The read failed: ' + errorObject.name);
}); 

//untuk dp
function loadFile(event) {
  var selectedFile = event.target.files[0];
  var reader = new FileReader();

  
  imgtag.title = selectedFile.name;

  reader.onload = function(event) {
    imgtag.src = event.target.result;
  };

  reader.readAsDataURL(selectedFile);
}










        
        
       
        
        
        
       
        
       
          </script>
        





        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
       </body>
</html>







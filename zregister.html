<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <!-- <h1> Register form</h1> -->
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Roboto:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="register.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

  <!--Firebase -->
  <script src=
"https://www.gstatic.com/firebasejs/7.2.0/firebase-auth.js">
	</script>

<script src=
"https://www.gstatic.com/firebasejs/7.2.0/firebase-app.js">
	</script>

</head>

<body class="d-flex flex-column min-vh-100">
  <header>
  </header>
  <content>
    <section class="vh-200" style="background-color: rgba(4, 73, 249, 0.8);">
      <div class="container h-100">
        <div class="row d-flex justify-content-center align-items-center h-100">
          <div class="col-lg-12 col-xl-11">
            <div class="card text-black" style="border-radius: 25px;">
              <div class="card-body p-md-5">
                <div class="row justify-content-center">
                  <div class="col-md-10 col-lg-6 col-xl-5 order-2 order-lg-1">
                    <p class="text-center h1 fw-bold mb-5 mx-1 mx-md-4 mt-4">Sign up</p>

                    <form class="mx-1 mx-md-4" id="registerform">
                      <div class="d-flex flex-row align-items-center mb-4">
                        <i class="fas fa-envelope fa-lg me-3 fa-fw"></i>
                        <div class="form-outline flex-fill mb-0">
                          <label class="form-label" for="form3Example3c">Email</label>
                          <input type="email" class="form-control" id="email" aria-describedby="emailHelp"
                            placeholder="Enter your student email address">
                          <p id="dis1"></p>
                        </div>
                      </div>
                      <div class="d-flex flex-row align-items-center mb-4">
                        <i class="fas fa-user fa-lg me-3 fa-fw"></i>
                        <div class="form-outline flex-fill mb-0">
                          <label class="form-label" for="form3Example1c">Full name</label>
                          <input type="username" class="form-control" id="Fullname" placeholder=" Enter your full name"
                            required>
                          <p id="dis5"></p>
                        </div>
                      </div>


                      <div class="d-flex flex-row align-items-center mb-4">
                        <i class="fas fa-envelope fa-lg me-3 fa-fw"></i>
                        <div class="form-outline flex-fill mb-0">
                          <label class="form-label" for="form3Example3c">Index Number / Staff ID</label>
                          <input type="username" class="form-control" id="matric" placeholder="Enter your student matric number">
                          <p id="dis1"></p>
                        </div>
                      </div>


                      

                      <div class="d-flex flex-row align-items-center mb-4">
                        <i class="fas fa-lock fa-lg me-3 fa-fw"></i>
                        <div class="form-outline flex-fill mb-0">
                          <label class="form-label" for="form3Example4c">Password</label>
                          <input type="password" class="form-control" id="password" placeholder="Enter password">
                          <p id="dis2"></p>
                        </div>
                      </div>

                      <div class="d-flex flex-row align-items-center mb-4">
                        <i class="fas fa-lock fa-lg me-3 fa-fw"></i>
                        <div class="form-outline flex-fill mb-0">
                          <label class="form-label" for="form3Example4c">Confirm Password</label>
                          <input type="password" class="form-control" id="password2" placeholder="Enter password again">
                          <p id="dis2"></p>
                        </div>
                      </div>


                      <div class="container">
                        <div class="row">
                          <div class="col">
                          
                            <div class="form-check form-switch">
                              <input class="form-check-input" type="checkbox" id="ExamInvigilator">
                              <label class="form-check-label" for="flexSwitchCheckDefault">Exam Invigilator</label>
                            </div>


                          </div>
                          <div class="col">
                           
                            <div class="form-check form-switch">
                              <input class="form-check-input" type="checkbox" id="Lecturer">
                              <label class="form-check-label" for="flexSwitchCheckDefault">Lecturer</label>
                            </div>


                          </div>
                        </div>
                        </div>




                  

                     



                      <p class="text-center text-muted mt-5 mb-0">
                        Have already an account?
                        <a href="zlogin.html">Login here</a>
                      </p>

                      <br />

                      <div id="rbtn" class="d-flex justify-content-center mb-1">
                        <button id="reg" type="button" class="btn btn-primary btn-lg">Register</button>
                      </div>
                    </form>

                  </div>
                  <div class="col-md-10 col-lg-6 col-xl-7 d-flex align-items-center order-1 order-lg-2">
                    <img class="img-fluid" src='assets/img/Quad.gif' alt="Sample image">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </content>





  <!-- src="https://cdn.pixabay.com/photo/2015/03/16/19/20/wall-676461_960_720.jpg" -->
  <script src=
"https://www.gstatic.com/firebasejs/3.7.4/firebase.js">
	</script>




  <script type="module">

    // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyB9tp7nBfMxsqBqgyQsCXE8gDhx7BSAaIk",
    authDomain: "e-cs-8e95e.firebaseapp.com",
    databaseURL: "https://e-cs-8e95e-default-rtdb.firebaseio.com",
    projectId: "e-cs-8e95e",
    storageBucket: "e-cs-8e95e.appspot.com",
    messagingSenderId: "648134779146",
    appId: "1:648134779146:web:c48d9e26dfeaa1d04d9af3"
  };


    // Initialize Firebase

    const app = initializeApp(firebaseConfig);
    firebase.initializeApp(firebaseConfig);

    

    import { getDatabase, ref, set, child, get }
      from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

    const db = getDatabase();

    const name = document.getElementById('Fullname');
    const email = document.getElementById('email');
    const matric = document.getElementById('matric');
    const pass = document.getElementById('password');
    const pass2 = document.getElementById('password2');
    const submit = document.getElementById('reg');

    function Validation() {
      let nameregex = /^[a-zA-Z\s]+$/;
      let emailregex = /^[a-zA-Z0-9]+@(gmail|yahoo|outlook)\.com$/;
      let userregex = /^[a-zA-Z0-9]{5,}$/;
      let passregex = /^[a-zA-Z0-9_@./#&+-]{5,}$/;

      if (isEmptyOrSpaces(name.value) || isEmptyOrSpaces(email.value) || isEmptyOrSpaces(matric.value) ||
        isEmptyOrSpaces(pass.value) || isEmptyOrSpaces(pass2.value)) {
        alert("you cannot leave any field empty or with spaces");
        return false;
      }

      if (!nameregex.test(name.value)) {
        alert("the name should only contain alphabets!");
        return false;
      }

      if (!passregex.test(pass.value)) {
        alert("password should be atleast 5 characters and not contain spaces!");
        return false;
      }

      if (!passregex.test(pass2.value)) {
        alert("password should be atleast 5 characters and not contain spaces!");
        return false;
      }

      

      
      return true;
    }

    



    function RegisterUser() {
      if (!Validation()) {
        return;
      }
      const dbRef = ref(db);

      if (pass.value == pass2.value) {

        
        

          get(child(dbRef, "Candidate/" + matric.value)).then((snapshot) => {
            if (snapshot.exists()) {
              alert("Account already exist!");
            }

            else if(document.getElementById('Lecturer').checked){

              set(ref(db, "Lecturer/" + matric.value),
                {
                  
                  email: email.value,
                  MatricNumber: matric.value,
                  fullname: name.value,
                  password: encPass(),
                  mobile:'012456789',
                  emergencycontactnumber:'012456789',
                  indexnumber:'88888'
                })
                .then(() => {
                  signUp();
                  alert("user added successfully");
                })
                .catch((error) => {
                  alert("error" + error);
                })



            }

            else if(document.getElementById('ExamInvigilator').checked){
              set(ref(db, "ExamInvigilator/" + matric.value),
                {
                  
                  email: email.value,
                  MatricNumber: matric.value,
                  fullname: name.value,
                  password: encPass(),
                  mobile:'012456789',
                  emergencycontactnumber:'012456789',
                  indexnumber:'88888'
                })
                .then(() => {
                  signUp();
                  alert("user added successfully");
                })
                .catch((error) => {
                  alert("error" + error);
                })



            }
            else {
              set(ref(db, "Candidate/" + matric.value),
                {
                  
                  email: email.value,
                  MatricNumber: matric.value,
                  fullname: name.value,
                  password: encPass(),
                  mobile:'012456789',
                  emergencycontactnumber:'012456789',
                  indexnumber:'88888'
                })
                .then(() => {
                  signUp();
                  alert("user added successfully");
                })
                .catch((error) => {
                  alert("error" + error);
                })
            }
          });
        

        

      }else{
        alert("Password does not match!");

      }

    }


    function signUp(){

// Your web app's Firebase configuration


const auth = firebase.auth();

var email = document.getElementById("email");
var password = document.getElementById("password");

const promise = auth.createUserWithEmailAndPassword(email.value, password.value);
promise.catch(e => alert(e.message));

alert("Signed Up");
}


    function encPass() {
      var pass12 = CryptoJS.AES.encrypt(pass.value, pass.value);
      return pass12.toString();
    }


    function isEmptyOrSpaces(str) {
      return str == null || str.match(/^ *$/) !== null;
    }

    submit.addEventListener('click', RegisterUser);

  </script>



</body>

</html>